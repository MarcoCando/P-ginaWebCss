<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academics</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" type="text/css" href="../Content/sweetalert2.min.css" />
    <script src="../Content/sweetalert2.all.min.js"></script>
    <script src="../Content/sweetalert2.min.js"></script>
    <link rel="stylesheet" href="Content/sweetalert2.min.css" />
    <script type="text/javascript" src="Content/sweetalert2.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="../Content/bootstrap.css" />
    <link rel="stylesheet" href="../Styles/StylesAcademics.css" />

    <script src="../Scripts/jquery-3.0.0.min.js"></script>

    <script src="../Scripts/bootstrap.min.js"></script>
    <script src="../Scripts/bootstrap.bundle.min.js"></script>
    <script src="../Confirmation/js/ConfirmationModal.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/df2ecd1a25.js" crossorigin="anonymous"></script>

</head>

<body>
    <section>
        <nav style="background-color: #153d64;">
            <div class="logo">
                <img src="assets/Logo64x64.png" />
                <h1>Sistema Académico</h1>
            </div>
            <div class="hamburger">
                <span class="line"></span>
                <span class="line"></span>
                <span class="line"></span>
            </div>
        </nav>
        <div class="menubar">
            <ul>
                <li>
                    <i class="fa-solid fa-arrow-right"></i><a href="#">Inicio <i class="fa-solid fa-house"></i></a>
                </li>
                <li>
                    <i class="fa-solid fa-arrow-right"></i><a href="#">Lenguaje <i
                            class="fa-solid fa-earth-americas"></i></a>
                    <i class="fa-solid fa-arrow-right"></i><a href="parametro.html">Español <img width="20" height="20"
                            src="https://img.icons8.com/color/48/spain-circular.png" alt="spain-circular" /></a>
                    <i class="fa-solid fa-arrow-right"></i><a href="Parametro2.html">Inglés <img width="20" height="20"
                            src="https://img.icons8.com/color/48/usa-circular.png" alt="usa-circular" /></a>
                </li>
            </ul>
        </div>
    </section>
    <section class="welcome">
        <div class="card m-2" style="background-color: #f5f5f5;">
            <div class="card-header">
                <div class="welcome-2">
                    <h2>Definición de Parametros <i class="fa fa-info-circle"></i></h2>
                </div>
            </div>
            <form action="">
                <div style="right: 20px; position: absolute; padding: 20px 50px;">
                    <a href="defparametro.html" type="button" class="btn btn-outline-success"
                        style="border-radius: 10px 40px 40px 10px; border: solid 1px;">
                        Siguiente
                    </a>
                </div>
                <div style="left: 20px; position: absolute; padding: 20px 50px; ">
                    <button type="button" class="btn btn-outline-info">
                        Guardar Cambios
                    </button>
                </div>
                <br>
                <div class="p-5">
                    <div class="input-group">
                        <div class="input-group-prepend col-2">
                            <span class="span-title">

                                Enfoque</span>
                        </div>
                        <div class="input-group-prepend col-9">
                            <input type="text" class="input100">
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-group-prepend col-2">
                            <span class="span-title">

                                Programa</span>
                        </div>
                        <div class="input-group-prepend col-9">
                            <input type="text" class="input100">
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-group-prepend col-2">
                            <span class="span-title">
                                País</span>
                        </div>
                        <div class="input-group-prepend col-2">
                            <input type="text" class="input100">
                        </div>
                        <div class="input-group-prepend col-2">
                            <span class="span-title">
                                Creditos</span>
                        </div>
                        <div class="input-group-prepend col-2">
                            <input type="number" class="input100" placeholder="0">
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-group-prepend col-2">
                            <span class="span-title"
                                style="top: 0; right: 0;left: 0; display: flex; justify-content: center; align-items: center;">
                                Resultados de A. Ins</span>
                        </div>
                        <div class="input-group-prepend col-9">
                            <div class="table-responsive">
                                <table class="table table-hover table-bordered" style="font-size: 12px;">
                                    <thead style="background-color: #cacaca; align-items: center; color: #3d3d3dc9;">
                                        <tr>
                                            <th scope="col" style="text-align: center;">Number</th>
                                            <th scope="col" style="text-align: center; width: 1000px;">Nombre</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="">
                                            <td scope="row" style="cursor: pointer;">Asignar Items <i
                                                    class="fa fa-plus-square" aria-hidden="true"
                                                    style="color: darkgreen;"></i> </td>
                                            <td></td>
                                        </tr>
                                        <tr class="" style="height: 60px; width: 1000px;">
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <hr>

                    <div class="input-group">
                        <div class="input-group-prepend col-2">
                            <span class="span-title"
                                style="top: 0; right: 0;left: 0; display: flex; justify-content: center; align-items: center;">
                                Resultados de Aprendizajes</span>
                        </div>
                        <div class="input-group-prepend col-9">
                            <textarea id="textareaContent" cols="110" rows="10" style="overflow: hidden"
                                readonly></textarea>
                            <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                                <div class="spinner">
                                    <div class="double-bounce1"></div>
                                    <div class="double-bounce2"></div>
                                </div>
                            </div>

                        </div>

                        <div class="input-group-prepend col-1">
                            <button onclick="handleButtonClick()" id="generar" type="button" class="btn btn-info"
                                style="font-size: 12px; border-radius: 50px; height: 40px;">
                                Generar
                            </button>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-group-prepend col-2">
                            <span class="span-title"
                                style="top: 0; right: 0;left: 0; display: flex; justify-content: center; align-items: center;">

                                Perfil de Egreso</span>
                        </div>
                        <div class="input-group-prepend col-9">
                            <textarea id="textareaContentPerfil" cols="110" rows="10" style="overflow: hidden"
                                readonly></textarea>
                            <div id="loadingOverlayPerfil" class="loading-overlay" style="display: none;">
                                <div class="spinner">
                                    <div class="double-bounce1"></div>
                                    <div class="double-bounce2"></div>
                                </div>
                            </div>
                        </div>
                        <div class="input-group-prepend col-1">
                            <button onclick="handleButtonClickPerfil()" id="generarPerfil" type="button"
                                class="btn btn-info" style="font-size: 12px; border-radius: 50px; height: 40px;">
                                Generar
                            </button>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-group-prepend col-2">
                            <span class="span-title"
                                style="top: 0; right: 0; left: 0; display: flex; justify-content: center; align-items: center;">
                                Diseño Curricular
                            </span>
                        </div>
                        <div class="input-group-prepend col-9">
                            <div id="tableContainer" class="table-responsive"></div>
                            <div id="loadingOverlayDiseño" class="loading-overlay" style="display: none;">
                                <div class="spinner">
                                    <div class="double-bounce1"></div>
                                    <div class="double-bounce2"></div>
                                </div>
                            </div>
                        </div>
                        <div class="input-group-prepend col-1">
                            <button onclick="handleButtonClickDiseño()" type="button" class="btn btn-info"
                                style="font-size: 12px; border-radius: 50px; height: 40px;">
                                Generar
                            </button>
                        </div>
                    </div>
                    <hr>
                    <br>
                </div>
        </div>
        </form>
    </section>

    <br>
    <footer class="container-fluid text-white py-4  float-right" style="background-color: #153d64;">
        <div class="d-flex">
            <div class="col-8 d-flex flex-column">
                <span>Tecnologia Informática - Departamento de Desarrollo de Aplicaciones
                </span>
                <span>Improve-IT
                </span>
                <span>Av. Amazonas y Unión de Periodistas
                </span>
            </div>
        </div>
    </footer>
    <script>
        /*RESULTADOS DE APRENDIZAJE*/
        async function fetchDataAndFormatRDA() {
            const rda = "comunicacion";
            const creditos = 3;
            const name = "MARKETING CON INTELIGENCIA ARTIFICIAL";
            try {
                const url = `http://172.191.10.174/api/rda/programa?rda=${rda}&creditos=${creditos}&name=${name}`;
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                const formatted = formatTextRDA(data.name);
                document.getElementById("textareaContent").value = formatted;
                adjustTextareaHeight();
                document.getElementById("loadingOverlay").style.display = "none";
            } catch (error) {
                console.error("Error al obtener datos:", error);
                document.getElementById("textareaContent").value = `Error al obtener datos: ${error.message}`;
                adjustTextareaHeight();
                document.getElementById("loadingOverlay").style.display = "none";
            }
        }
        function adjustTextareaHeight() {
            const textarea = document.getElementById("textareaContent");
            textarea.style.height = "110px";
            textarea.style.height = `${textarea.scrollHeight}px`;
        }
        function formatTextRDA(text) {
            let formatted = text.replace(/\\n/g, "\n");
            if (formatted.includes("\n")) {
                formatted += "\n";
            }
            return formatted;
        }
        async function SpinnerRDA() {
            document.getElementById("loadingOverlay").style.display = "flex";
            document.getElementById('generar').textContent = 'Cargando...';
            document.getElementById('textareaContent').value = 'Cargando Contenido ...';
            try {
                await new Promise((resolve) => setTimeout(resolve, 1200));
            } catch (error) {
                console.error("Error al realizar la solicitud:", error);
            } finally {
                document.getElementById("loadingOverlay").style.display = "none";
                document.getElementById('generar').textContent = 'Generar';

            }
        }
        function handleButtonClick() {
            SpinnerRDA();
            fetchDataAndFormatRDA();
        }
        /*FIN DE RESULTADO DE APRENDIZAJE*/
        /*PERFIL DE EGRESO*/
        async function fetchDataAndFormatPerfil() {
            const rdaper = "1. Integra técnicas avanzadas de inteligencia artificial para desarrollar estrategias de marketing innovadoras y efectivas. 2. Evalúa la eficacia de las campañas de marketing personalizadas mediante el uso de algoritmos y análisis de datos para optimizar su rendimiento. 3. Diseña y ejecuta estrategias de marketing basadas en inteligencia artificial para optimizar la adquisición y retención de clientes de manera rentable.";
            const enfoque = "MARKETING EN INTELIGENCIA ARTIFICIAL";
            const nameper = "MARKETING CON INTELIGENCIA ARTIFICIAL";
            try {
                const url = `http://172.191.10.174/api/perfil/programa?rda=${rdaper}&enfoque=${enfoque}&name=${nameper}`;
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                const formatted = formatTextPerfil(data.name);
                document.getElementById("textareaContentPerfil").value = formatted;
                adjustTextareaHeightPerfil();
                document.getElementById("loadingOverlayPerfil").style.display = "none";
            } catch (error) {
                console.error("Error al obtener datos:", error);
                document.getElementById("textareaContentPerfil").value = `Error al obtener datos: ${error.message}`;
                adjustTextareaHeightPerfil();
                document.getElementById("loadingOverlayPerfil").style.display = "none";
            }
        }
        function formatTextPerfil(text) {
            let formatted = text.replace(/\\n/g, "\n");
            if (formatted.includes("\n")) {
                formatted += "\n\n";
            }
            return formatted;
        }
        async function SpinnerPerf() {
            document.getElementById("loadingOverlayPerfil").style.display = "flex";
            document.getElementById('generarPerfil').textContent = 'Cargando...';
            document.getElementById('textareaContentPerfil').value = 'Cargando Contenido ...';
            try {
                await new Promise((resolve) => setTimeout(resolve, 4000));
            } catch (error) {
                console.error("Error al realizar la solicitud:", error);
            } finally {
                document.getElementById("loadingOverlayPerfil").style.display = "none";
                document.getElementById('generarPerfil').textContent = 'Generar';
            }
        }
        function handleButtonClickPerfil() {
            SpinnerPerf();
            fetchDataAndFormatPerfil();
        }
        function adjustTextareaHeightPerfil() {
            const textarea = document.getElementById("textareaContentPerfil");
            textarea.style.height = "110px";
            textarea.style.height = `${textarea.scrollHeight}px`;
        }
        /*FIN DE PERFIL DE EGRESO*/
        /*DISEÑO CURRICULAR*/
        let programData = null;
        let loadingDiseño = false;

        async function fetchData() {
            try {
                const url = "http://172.191.10.174/api/diseno/programa";
                const body = {
                    rdas: "1. Integra técnicas avanzadas de inteligencia artificial para desarrollar estrategias de marketing innovadoras y efectivas. 2. Evalúa la eficacia de las campañas de marketing personalizadas mediante el uso de algoritmos y análisis de datos para optimizar su rendimiento. 3. Diseña y ejecuta estrategias de marketing basadas en inteligencia artificial para optimizar la adquisición y retención de clientes de manera rentable.",
                };

                const response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(body),
                });

                if (!response.ok) {
                    throw new Error("Error al obtener los datos");
                }

                const data = await response.json();
                programData = data;
                renderTable();
            } catch (error) {
                console.error("Error al obtener datos:", error);
                document.getElementById("tableContainer").innerHTML = "Error al obtener los datos";
            }
        }

        function renderTable() {
            if (!programData) return;

            let shouldStopRendering = false;
            let totalCredits = 0;

            const rows = programData.name
                .split("\n")
                .filter(Boolean)
                .slice(1, -1)
                .map((item, index) => {
                    if (shouldStopRendering) return null;

                    if (item === "\\n\\n") {
                        shouldStopRendering = true;
                        return null;
                    }

                    const parts = item.split(" - ");
                    const number = extractNumber(parts[0]);
                    const description = extractDescription(parts[0]);
                    const credits = extractCredits(parts[1]);
                    if (!isNaN(parseInt(credits))) {
                        totalCredits += parseInt(credits);
                    }
                    return `
        <tr>
          <td style="text-align: center;">${number}</td>
          <td>${description}</td>
          <td style="text-align: center;">${credits}</td>
        </tr>
      `;
                })
                .filter(Boolean)
                .join("");

            const totalRow = `
    <tr>
      <td colspan="2" style="text-align: center;">Total Créditos</td>
      <td style="text-align: center;">${totalCredits}</td>
    </tr>
  `;

            const tableHTML = `
    <table class="table table-hover table-bordered" style="font-size: 12px;">
      <thead style="background-color: #cacaca; text-align: center; color: #3d3d3dc9;">
        <tr>
          <th>Number</th>
          <th>Nombre Asignatura</th>
          <th>Créditos</th>
        </tr>
      </thead>
      <tbody>${rows}${totalRow}</tbody>
    </table>
  `;

            document.getElementById("tableContainer").innerHTML = tableHTML;
        }

        function extractNumber(text) {
            const match = text.match(/\{?\d+\}?/);
            return match ? match[0] : "";
        }

        function extractDescription(text) {
            const description = text.replace(/\{?\d+\}?\.\s*/, "");
            const index = description.indexOf("\\n\\n");
            return index !== -1 ? description.substring(0, index) : description;
        }

        function extractCredits(text) {
            const match = text && text.match(/\d+/);
            return match ? match[0] : "";
        }

        async function SpinnerDiseño() {
            document.getElementById("loadingOverlayDiseño").style.display = "flex";
            try {
                await new Promise((resolve) => setTimeout(resolve, 6000));
            } catch (error) {
                console.error("Error al realizar la solicitud:", error);
            } finally {
                document.getElementById("loadingOverlayDiseño").style.display = "none";
            }
        }

        function handleButtonClickDiseño() {
            SpinnerDiseño();
            fetchData();
        }
        /*FIN DISEÑO CURRICULAR*/
    </script>
    <script src="Styles/script.js"></script>
</body>

</html>